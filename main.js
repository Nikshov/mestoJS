(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputSelector=t.inputSelector,this._submitButton=t.submitButton,this._disableSubmitButton=t.disableSubmitButton,this._inputError=t.inputError,this._errorClass=t.errorClass,this._form=n}var n,o;return n=e,(o=[{key:"_showInputError",value:function(t,e){var n=this._form.querySelector(".".concat(t.id,"-error"));t.classList.add(this._inputError),n.textContent=e,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(t){var e=this._form.querySelector(".".concat(t.id,"-error"));t.classList.remove(this._inputError),e.classList.remove(this._errorClass),e.textContent=""}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"_setEventListeners",value:function(){var t=this;this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButton),this._toggleButtonState(),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState()}))}))}},{key:"_clearErrors",value:function(){var t=this;this._inputList.forEach((function(e){t._hideInputError(e)}))}},{key:"enableValidation",value:function(){this._setEventListeners(),this._form.addEventListener("submit",(function(t){t.preventDefault()}))}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._disableSubmitButton),this._buttonElement.setAttribute("disabled","disabled")):(this._buttonElement.classList.remove(this._disableSubmitButton),this._buttonElement.removeAttribute("disabled"))}},{key:"resetValidation",value:function(){this._clearErrors(),this._toggleButtonState()}}])&&t(n.prototype,o),e}(),n={inputSelector:".popup__input",submitButton:".popup__save-button",disableSubmitButton:"popup__save-button_disabled",inputError:"popup__input_type_error",errorClass:"popup__input-error_active"},o=document.querySelector(".popup_type_edit-profile"),r=o.querySelector(".popup__input_field_name"),i=o.querySelector(".popup__input_field_about"),u=document.querySelector(".profile__edit-button"),a=o.querySelector(".popup__form"),c=document.querySelector(".popup_type_add-place").querySelector(".popup__form"),s=document.querySelector(".profile__add-button"),l=document.querySelector(".popup_type_editAvatar").querySelector(".popup__form"),f=document.querySelector(".profile__avatar-container");function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var h=function(){function t(e){var n=this,o=e.data,r=e.myUserId,i=e.templateSelector,u=e.handleCardClick,a=e.handleDeleteButton,c=e.handleHeartButton;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=o.name,this._link=o.link,this.likes=o.likes,this._myUserId=r.id,this._templateSelector=i,this._handleCardClick=u,this._handleDeleteButton=a,this._handleHeartButton=c,this._iAmOwner=o.owner._id===this._myUserId,this.iLikedIt=this.likes.find((function(t){return t._id===n._myUserId})),this._id=o._id}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._deleteButton=this._element.querySelector(".element__delete-button"),this._heartButton=this._element.querySelector(".element__heart-button"),this._amountLikes=this._element.querySelector(".element__amount-likes"),this._iAmOwner||this._deleteButton.remove(),this.iLikedIt&&this._heartButton.classList.add("element__heart-button_active"),this._fillElement(),this._addEventListeners(),this._element}},{key:"_fillElement",value:function(){this._elementImg=this._element.querySelector(".element__image"),this._elementImg.src=this._link,this._elementImg.alt=this._name,this._element.querySelector(".element__title").textContent=this._name,this._amountLikes.textContent=this.likes.length}},{key:"_addEventListeners",value:function(){this._heartButton.addEventListener("click",this._handleHeartButton),this._iAmOwner&&this._deleteButton.addEventListener("click",this._handleDeleteButton),this._element.querySelector(".element__image").addEventListener("click",this._handleCardClick)}},{key:"toggleHeartButton",value:function(t){this.likes=t,this.iLikedIt=!this.iLikedIt,this._heartButton.classList.toggle("element__heart-button_active"),this._amountLikes.textContent=this.likes.length}},{key:"getCardId",value:function(){return this._id}},{key:"getElement",value:function(){return this._element}}])&&p(e.prototype,n),t}();function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var d=function(){function t(e,n){var o=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=o,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"renderItems",value:function(t){var e=this;t.forEach((function(t){return e._renderer(t)}))}},{key:"addItems",value:function(t){this._container.append(t)}},{key:"addItem",value:function(t){this._container.prepend(t)}},{key:"removeItem",value:function(t){t.remove()}}])&&_(e.prototype,n),t}();function y(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var m=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._popup.addEventListener("click",(function(e){e.target.classList.contains("popup")&&t.close()})),this._popup.querySelector(".popup__close-button").addEventListener("click",this.close.bind(this))}}])&&y(e.prototype,n),t}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function k(t,e,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=w(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var L=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(o);if(r){var n=w(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return S(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._handleFormSubmit=e,n._inputList=n._popup.querySelectorAll(".popup__input"),n._popupForm=n._popup.querySelector(".popup__form"),n._formSubmit=n._formSubmit.bind(E(n)),n._saveButton=n._popup.querySelector(".popup__save-button"),n}return e=u,(n=[{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"_formSubmit",value:function(t){t.preventDefault(),this._handleFormSubmit(this._getInputValues())}},{key:"setEventListeners",value:function(){this._popupForm.addEventListener("submit",this._formSubmit),k(w(u.prototype),"setEventListeners",this).call(this)}},{key:"renderLoading",value:function(){this._saveButton.textContent="Сохранение..."}},{key:"renderDefault",value:function(){this._saveButton.textContent="Сохранить"}},{key:"close",value:function(){this._popupForm.reset(),k(w(u.prototype),"close",this).call(this)}}])&&b(e.prototype,n),u}(m);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function I(t,e,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=j(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=j(o);if(r){var n=j(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return T(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._popupImg=e._popup.querySelector(".popup__img"),e._popupTitle=e._popup.querySelector(".popup__place-name"),e}return e=u,(n=[{key:"open",value:function(t,e){this._popupImg.alt=t,this._popupImg.src=e,this._popupTitle.textContent=t,I(j(u.prototype),"open",this).call(this)}}])&&O(e.prototype,n),u}(m);function P(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var R=function(){function t(e){var n=e.nameSelector,o=e.aboutSelector,r=e.avatarSelector;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=document.querySelector(n),this._about=document.querySelector(o),this._avatar=document.querySelector(r)}var e,n;return e=t,(n=[{key:"setUserInfo",value:function(t){this._name.textContent=t.name,this._about.textContent=t.about,this._avatar.src=t.avatar,this._id=t._id}},{key:"getUserInfo",value:function(){return{name:this._name.textContent,about:this._about.textContent,avatar:this._avatar.src,id:this._id}}}])&&P(e.prototype,n),t}();function x(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var z=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.url,this._authorization=e.headers.authorization,this._contentType=e.headers["Content-Type"]}var e,n;return e=t,(n=[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}},{key:"getInitialCards",value:function(){return fetch("".concat(this._url,"/cards"),{headers:{authorization:this._authorization}}).then(this._checkResponse)}},{key:"addNewCard",value:function(t){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:t.name,link:t.link})}).then(this._checkResponse)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._url,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"addLike",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"deleteLike",value:function(t){return fetch("".concat(this._url,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._authorization,"Content-Type":this._contentType}}).then(this._checkResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{headers:{authorization:this._authorization}}).then(this._checkResponse)}},{key:"editUserInfo",value:function(t){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({name:t.name,about:t.about})}).then(this._checkResponse)}},{key:"editAvatar",value:function(t){var e=t.link;return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._authorization,"Content-Type":this._contentType},body:JSON.stringify({avatar:"".concat(e)})}).then(this._checkResponse)}}])&&x(e.prototype,n),t}();function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function V(t,e,n){return(V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=H(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(u,t);var e,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=H(o);if(r){var n=H(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return F(this,t)});function u(t){var e,n=t.popupSelector,o=t.handleFormSubmit;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,n))._handleFormSubmit=o,e._popupForm=e._popup.querySelector(".popup__form"),e._saveButton=e._popup.querySelector(".popup__save-button"),e}return e=u,(n=[{key:"open",value:function(t){V(H(u.prototype),"open",this).call(this),this._card=t}},{key:"renderLoading",value:function(){this._saveButton.textContent="Удаление..."}},{key:"renderDefault",value:function(){this._saveButton.textContent="Да"}},{key:"setEventListeners",value:function(){var t=this;this._popupForm.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._card)})),V(H(u.prototype),"setEventListeners",this).call(this)}}])&&U(e.prototype,n),u}(m),J=new e(n,a);J.enableValidation();var M=new e(n,c);M.enableValidation();var G=new e(n,l);G.enableValidation();var K=new z({url:"https://mesto.nomoreparties.co/v1/cohort-25",headers:{authorization:"102ba505-245e-4e79-bcbe-97cbfaa7a3eb","Content-Type":"application/json"}}),Q=new L(".popup_type_editAvatar",(function(t){Q.renderLoading(),K.editAvatar(t).then((function(t){Z.setUserInfo(t),Q.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){return Q.renderDefault()}))}));Q.setEventListeners(),f.addEventListener("click",(function(){G.resetValidation(),Q.open()})),s.addEventListener("click",(function(){M.resetValidation(),Y.open()})),u.addEventListener("click",(function(){var t=Z.getUserInfo();r.value=t.name,i.value=t.about,J.resetValidation(),$.open()}));var W=new q(".popup_type_img-viewer");W.setEventListeners();var X=new d({renderer:function(t){return X.addItems(tt(t))}},".elements"),Y=new L(".popup_type_add-place",(function(t){Y.renderLoading(),K.addNewCard(t).then((function(t){X.addItem(tt(t)),Y.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){return Y.renderDefault()}))}));Y.setEventListeners();var Z=new R({nameSelector:".profile__info-name",aboutSelector:".profile__info-about",avatarSelector:".profile__avatar"}),$=new L(".popup_type_edit-profile",(function(t){$.renderLoading(),K.editUserInfo(t).then((function(t){Z.setUserInfo(t),$.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){return $.renderDefault()}))}));function tt(t){var e=new h({data:t,myUserId:Z.getUserInfo(),templateSelector:".template-element",handleCardClick:function(){W.open(t.name,t.link)},handleDeleteButton:function(){et.open(e)},handleHeartButton:function(){e.iLikedIt?K.deleteLike(e.getCardId()).then((function(t){e.toggleHeartButton(t.likes)})).catch((function(t){return console.log("Error ".concat(t))})):K.addLike(e.getCardId()).then((function(t){e.toggleHeartButton(t.likes)})).catch((function(t){return console.log("Error ".concat(t))}))}});return e.generateCard()}$.setEventListeners();var et=new N({popupSelector:".popup_type_confirm",handleFormSubmit:function(t){et.renderLoading(),K.deleteCard(t.getCardId()).then((function(){X.removeItem(t.getElement()),et.close()})).catch((function(t){return console.log("Error ".concat(t))})).finally((function(){return et.renderDefault()}))}});et.setEventListeners(),window.onload=function(){Promise.all([K.getUserInfo(),K.getInitialCards()]).then((function(t){Z.setUserInfo(t[0]),X.renderItems(t[1])})).catch((function(t){return console.log("Error ".concat(t))}))}})();